function t(t){return t&&"object"==typeof t&&"default"in t?t.default:t}var i=require("pixi.js");require("pixi-layers");var e=require("howler"),s=t(require("localforage")),n=t(require("walkable")),o=require("polyk"),a=t(require("pixi-dragonbones")),h=t(require("dragonbones-pixi")),r=require("gsap");require("gsap/PixiPlugin");var c=function(t){function i(){t.call(this),this.game=null,this.onLoad.add(this.update.bind(this)),this.onError.add(this.error.bind(this)),this.use(this.howlerMiddleware.bind(this))}return t&&(i.__proto__=t),(i.prototype=Object.create(t&&t.prototype)).constructor=i,i.prototype.howlerMiddleware=function(t,i){if(t&&["wav","ogg","mp3"].includes(t.extension)){var s=JSON.parse(JSON.stringify(t.metadata));s.src=[t.url],t.sound=new e.Howl(s),i()}else i()},i.prototype.addJSON=function(t){var i,e=t.length;for(i=0;i<e;i++){var s=t[i].slice(t[i].lastIndexOf("/")+1,t[i].lastIndexOf("."));this.add(s,t[i])}},i.prototype.addFiles=function(t){var i,e=t.length;for(i=0;i<e;i++){if(t[i].data.Settings&&(this.game.settings=t[i].data.Settings),t[i].data.Scenes&&(this.game.data.scenes=this.game.data.scenes.concat(t[i].data.Scenes)),t[i].data.Cutscenes&&(this.game.data.cutscenes=this.game.data.cutscenes.concat(t[i].data.Cutscenes)),t[i].data.Objects&&(this.game.data.objects=this.game.data.objects.concat(t[i].data.Objects)),t[i].data.Dialogues&&(this.game.data.dialogues=this.game.data.dialogues.concat(t[i].data.Dialogues)),t[i].data.Puzzles&&(this.game.data.puzzles=this.game.data.puzzles.concat(t[i].data.Puzzles)),t[i].data.Credits&&(this.game.data.credits=t[i].data.Credits),t[i].data.Texts&&(this.game.data.texts=t[i].data.Texts),t[i].data.Sounds)for(var s=t[i].data.Sounds,n=0;n<s.length;n++){var o=s[n].Src;null!==o&&this.add(s[n].Name,o)}if(t[i].data.Vids)for(var a=t[i].data.Vids,h=0;h<a.length;h++){var r=a[h].Src;null!==r&&this.add(a[h].Name,r)}if(t[i].data.Animations)for(var c=t[i].data.Animations,d=0;d<c.length;d++){var p=c[d].Src;null!==p&&this.add(c[d].Name,p)}if(t[i].data.Backgrounds)for(var g=t[i].data.Animations,u=0;u<g.length;u++){var l=g[u].Src;null!==l&&this.add(g[u].Name,l)}if(t[i].data.Player&&(this.add("playerTex",t[i].data.Player.Texture).add("playerJson",t[i].data.Player.Json).add("playerSkeleton",t[i].data.Player.Skeleton),this.game.data.player=t[i].data.Player),t[i].data.Characters){for(var m=t[i].data.Characters,f=0;f<m.length;f++)this.add(m[f].Name+"Tex",m[f].Texture).add(m[f].Name+"Json",m[f].Json).add(m[f].Name+"Skeleton",m[f].Skeleton);this.game.data.npc=t[i].data.Characters}}},i.prototype.update=function(){var t=Math.floor(this.progress);this.game.progressBar.width=this.game.width/100*t},i.prototype.error=function(t){console.log(t)},i}(PIXI.loaders.Loader),d=function(t){this.game=t};d.prototype.save=function(){var t=[];Object.values(this.game.puzzles).forEach(function(i){i.solved&&!t.includes(i.config.Name)&&t.push(i.config.Name)});var i=[];Object.values(this.game.dialogues).forEach(function(t){Object.values(t.branches).forEach(function(e){e.Choices.forEach(function(s,n){s.disabled&&i.push({Dialogue:t.config.Name,Branch:e.Name,Index:n})})})});var e=[];Object.values(this.game.cutscenes).forEach(function(t){t.played&&e.push(t.config.Name)}),this.progress={language:this.game.activeLanguage,latestScene:this.game.activeScene.config.Name,playerPos:[this.game.player.sprite.x,this.game.player.sprite.y],inventory:this.game.inventory.objects,puzzles:t,dialogues:i,cutscenes:e},s.setItem("JSGAM_Storage",this.progress)},d.prototype.load=function(){var t=this.game;this.progress.dialogues.forEach(function(i){t.dialogues[i.Dialogue].branches[i.Branch].Choices[i.Index].disabled=!0}),this.progress.cutscenes.forEach(function(i){t.cutscenes[i].played=!0}),this.game.silentMode=!0,this.progress.puzzles.forEach(function(i){t.puzzles[i].resolve()}),this.progress.inventory.forEach(function(i){t.inventory.add(i);var e=i;Object.values(t.scenes).forEach(function(t){if(void 0!==t.config.Objects&&t.config.Objects.includes(e)){var i=t.config.Objects.indexOf(e);t.config.Objects.splice(i,1)}})}),this.game.silentMode=!1,this.game.player.sprite.x=this.progress.playerPos[0],this.game.player.sprite.y=this.progress.playerPos[1]},d.prototype.delete=function(){s.clear()},d.prototype.check=function(){var t=this;s.getItem("JSGAM_Storage").then(function(i){null!==i&&(t.progress=i,t.game.activeLanguage=i.language,t.game.scenes.Title.changeLanguage(),t.game.scenes.Title.states.MainMenu.enable("Continue"))}).catch(function(t){console.log(t)})};var p=function(t){this.game=t};p.prototype.play=function(t){var i=this.game.files.resources[t].sound;i.loop(!0),i.play()},p.prototype.stop=function(t){var i=this.game.files.resources[t].sound;i.on("fade",this.onFade.bind(i)),i.fade(1,0,1e3)},p.prototype.onFade=function(){this.stop(),this.volume(1)};var g=function(){this.container=new PIXI.Container,this.game=null};g.prototype.setup=function(t){this.background=new PIXI.Sprite(PIXI.Texture.from(t.Background)),this.background.anchor.set(0),this.container.addChild(this.background),void 0!==t.Foreground&&(this.foreground=new PIXI.Sprite(PIXI.Texture.from(t.Foreground)),this.foreground.anchor.set(0),this.container.addChild(this.foreground)),this.music=t.Music,this.config=t},g.prototype.update=function(t){},g.prototype.hide=function(){this.container.visible=!1},g.prototype.show=function(){this.container.visible=!0};var u=function(t){function i(i,e){t.call(this,i,e),this.interactive=!0,this.buttonMode=!0}return t&&(i.__proto__=t),(i.prototype=Object.create(t&&t.prototype)).constructor=i,i}(PIXI.extras.BitmapText),l=function(t){function i(i,e){t.call(this,i,e)}return t&&(i.__proto__=t),(i.prototype=Object.create(t&&t.prototype)).constructor=i,i}(PIXI.extras.BitmapText),m=function(t){this.container=new PIXI.Container,this.hide(),this.game=t,this.option=[];for(var i=0;i<this.game.dialogueChoices;i++)this.option[i]=new u("Option",this.game.settings.Text.ButtonStyle),this.option[i].game=this.game,this.option[i].anchor.set(.5,0),this.option[i].on("pointertap",this.onTap.bind(this.option[i])),this.option[i].index=i,this.container.addChild(this.option[i]),this.option[i].x=this.container.width/2,i>0&&(this.option[i].y=this.option[i-1].y+this.option[i-1].height)};m.prototype.show=function(){this.container.visible=!0},m.prototype.hide=function(){this.container.visible=!1},m.prototype.onTap=function(){var t=this.game.activeDialogue.currentBranch.Choices;1==this.alpha&&(this.game.activeDialogue.choice=this.index,0==t[this.index].Repeat&&(t[this.index].disabled=!0),this.game.activeDialogue.next())},m.prototype.get=function(){this.clear();for(var t=this.game.activeDialogue.currentBranch.Choices,i=0;i<t.length;i++)this.option[i].alpha=t[i].disabled?.5:1,this.option[i].visible=!0,this.option[i].text=t[i].Text[this.game.activeLanguage];this.sort(),this.show()},m.prototype.clear=function(){for(var t=0;t<this.option.length;t++)this.option[t].visible=!1},m.prototype.sort=function(){for(var t=0;t<this.option.length;t++)this.option[t].x=this.container.width/2;(this.container.width>this.container.parent.width||this.container.height>this.container.parent.height)&&this.scale(),this.center()},m.prototype.scale=function(){var t=Math.min(this.game.width/this.container.width,this.container.parent.height/this.container.height);this.container.scale.set(.95*t)},m.prototype.center=function(){this.container.x=this.game.width/2,this.container.pivot.x=this.container.width/2};var f=function(){this.container=new PIXI.Container,this.Avatar=null,this.Background=null,this.Text=null,this.container.visible=!1};f.prototype.build=function(){this.container.parentLayer=this.game.layerUI,this.Background=new PIXI.Sprite(PIXI.Texture.WHITE);var t=4;void 0!==this.game.settings.Text.Size&&("fourth"===this.game.settings.Text.Size?t=4:"half"===this.game.settings.Text.Size&&(t=2)),this.Background.width=this.game.width,this.Background.height=this.game.height/t,this.Background.tint="black",this.Background.alpha=.5,this.Avatar=new PIXI.Sprite(PIXI.Texture.from(this.game.data.player.Avatar));var i=this.Avatar.width/this.Avatar.height;this.Avatar.height=this.Background.height,this.Avatar.width=this.Avatar.height*i*.95,this.Text=new u("",this.game.settings.Text.Style),this.Text.x=1.05*this.Avatar.width,this.Text.maxWidth=this.game.width-this.Avatar.width,this.Text.y=0,this.Text.on("pointertap",this.skip.bind(this)),this.Choices=new m(this.game),this.container.addChild(this.Background),this.container.addChild(this.Avatar),this.container.addChild(this.Text),this.container.addChild(this.Choices.container),this.Choices.sort(),void 0!==this.game.settings.Text.Position&&this.setPosition(this.game.settings.Text.Position)},f.prototype.show=function(){this.Text.visible=!0,this.container.visible=!0},f.prototype.hide=function(){this.container.visible=!1},f.prototype.end=function(){null!==this.game.activeDialogue?(this.talker.shutup(),null!==this.game.activeDialogue.choice?this.game.activeDialogue.answer():(this.Text.visible=!1,this.Avatar.visible=!1,this.Choices.get())):(this.setText(""),this.hide(),this.talker.shutup(),this.game.player.stop(),null!==this.game.activeObject&&this.game.activeObject.cancel())},f.prototype.skip=function(){this.end(),this.talker&&clearTimeout(this.talker.timeoutID)},f.prototype.setPosition=function(t){"top"===t?(this.container.x=0,this.container.y=0):"bottom"===t&&(this.container.x=0,this.container.y=this.game.height-this.container.height)},f.prototype.setText=function(t){this.Text.text=t,(this.Text.width>this.container.width||this.Text.height>this.container.height)&&this.adjustText()},f.prototype.adjustText=function(){var t=Math.min(this.container.width/this.Text.width,this.container.height/this.Text.height);this.container.scale.set(.95*t)},f.prototype.countWords=function(t){return t.split(" ").length},f.prototype.timeOut=function(){var t;return(t=void 0!==this.game.settings.Text.Speed?this.game.settings.Text.Speed:this.countWords(this.Text.text)/3)<1&&(t=1),1e3*t},f.prototype.setColor=function(t){this.Text.tint=t},f.prototype.setFont=function(t){this.Text.font=t},f.prototype.setAvatar=function(t){this.Avatar.visible=!0,this.Avatar.texture=PIXI.Texture.from(t)},f.prototype.hideAvatar=function(){this.Avatar.visible=!1};var y=function(){this.container=new PIXI.Container,this.game=null,this.buttons={}};y.prototype.addButton=function(t,i){this.buttons[t]=new u(i[this.game.activeLanguage],this.game.settings.Text.ButtonStyle),this.container.addChild(this.buttons[t])},y.prototype.modify=function(t,i){this.buttons[t].text=i[this.game.activeLanguage]},y.prototype.disable=function(t){this.buttons[t].alpha=.5,this.buttons[t].interactive=!1},y.prototype.enable=function(t){this.buttons[t].alpha=1,this.buttons[t].interactive=!0},y.prototype.sort=function(){var t,i=Object.values(this.buttons),e=i.length;for(i[0].y=0,t=1;t<e;t++)i[t].y=i[t-1].y+1.5*i[t-1].height,i[t].x=this.container.width/2-i[t].width/2;this.center()},y.prototype.resize=function(){var t=Math.min(this.game.width/this.container.width,this.game.height/this.container.height);this.container.scale.set(.95*t)},y.prototype.hide=function(){this.container.visible=!1},y.prototype.show=function(){this.container.visible=!0},y.prototype.center=function(){this.container.x=this.game.width/2,this.container.y=this.game.height/2,this.container.pivot.x=this.container.width/2,this.container.pivot.y=this.container.height/2};var v=function(t){function i(){t.apply(this,arguments)}return t&&(i.__proto__=t),(i.prototype=Object.create(t&&t.prototype)).constructor=i,i.prototype.create=function(){var t=this.game.data.texts;this.addButton("New",t.NewGame),this.addButton("Continue",t.Continue),this.addButton("Options",t.Options),this.addButton("Help",t.Help),this.addButton("Credits",t.Credits),this.disable("Continue"),this.sort()},i.prototype.changeLanguage=function(){this.modify("New",this.game.data.texts.NewGame),this.modify("Continue",this.game.data.texts.Continue),this.modify("Options",this.game.data.texts.Options),this.modify("Help",this.game.data.texts.Help),this.modify("Credits",this.game.data.texts.Credits),this.sort()},i}(y),b=function(t){function i(){t.apply(this,arguments)}return t&&(i.__proto__=t),(i.prototype=Object.create(t&&t.prototype)).constructor=i,i.prototype.create=function(){this.container.visible=!1;for(var t=this.game.settings.Languages,i=0;i<t.length;i++)this.addLanguage(t[i]),this.buttons[t[i]].on("pointerup",this.setLanguage);Object.values(this.buttons)[this.game.activeLanguage].tint=16711680,this.addButton("Back",this.game.data.texts.Back),this.sort()},i.prototype.addLanguage=function(t){this.buttons[t]=new u(t,this.game.settings.Text.ButtonStyle),this.buttons[t].father=this,this.container.addChild(this.buttons[t])},i.prototype.setLanguage=function(){this.father.change(this.text)},i.prototype.change=function(t){var i=this.game.settings.Languages;this.buttons[i[this.game.activeLanguage]].tint=16777215,this.game.activeLanguage=this.game.settings.Languages.indexOf(t),this.buttons[i[this.game.activeLanguage]].tint=16711680,this.modify("Back",this.game.data.texts.Back),this.sort()},i}(y),x=function(){this.container=new PIXI.Container,this.container.visible=!1,this.container.interactive=!0,this.container.buttonMode=!0};x.prototype.create=function(){this.background=new PIXI.Sprite(PIXI.Texture.from(this.game.settings.Help[this.game.activeLanguage])),this.container.addChild(this.background),this.center(),this.container.on("pointerup",this.mainMenu.bind(this))},x.prototype.show=function(){this.container.visible=!0},x.prototype.hide=function(){this.container.visible=!1},x.prototype.changeLanguage=function(){this.background.texture=PIXI.Texture.from(this.game.settings.Help[this.game.activeLanguage]),this.center()},x.prototype.center=function(){this.container.x=this.game.width/2,this.container.y=this.game.height/2,this.container.pivot.x=this.container.width/2,this.container.pivot.y=this.container.height/2},x.prototype.mainMenu=function(){this.game.scenes.Title.mainMenu()};var w=function(){this.container=new PIXI.Container,this.container.visible=!1,this.container.interactive=!0,this.container.buttonMode=!0};w.prototype.create=function(){var t=this.game.data.credits;void 0!==t.Background&&(this.background=new PIXI.Sprite(PIXI.Texture.from(t.Background)),this.container.addChild(this.background)),this.buildText(),this.speed=null,this.speed=void 0!==this.game.data.credits.Time?this.game.data.credits.Time:20,this.structuredText=new PIXI.extras.BitmapText(this.text,t.Style),this.tween=null,this.container.addChild(this.structuredText),this.container.x=this.game.width/2,this.container.pivot.x=this.container.width/2,this.container.y=this.game.height,this.container.on("pointerup",this.mainMenu.bind(this))},w.prototype.show=function(){this.container.visible=!0,this.animate()},w.prototype.animate=function(){r.TweenMax.set(this.container,{y:this.game.height}),this.tween=r.TweenMax.to(this.container,20,{y:0-this.container.height,onComplete:this.mainMenu.bind(this)})},w.prototype.hide=function(){this.container.visible=!1},w.prototype.buildText=function(){var t,i=this.game.data.credits;for(this.text="",t=0;t<i.Lines.length;t++){this.text+=i.Lines[t].Title[this.game.activeLanguage],this.text+="\n";var e=void 0;for(e=0;e<i.Lines[t].Text.length;e++)this.text+=i.Lines[t].Text[e],this.text+="\n";this.text+="\n"}},w.prototype.update=function(){},w.prototype.changeLanguage=function(){this.buildText(),this.structuredText.text=this.text},w.prototype.mainMenu=function(){this.tween.kill(),this.game.scenes.Title.mainMenu()};var I=function(t){function i(){t.apply(this,arguments)}return t&&(i.__proto__=t),(i.prototype=Object.create(t&&t.prototype)).constructor=i,i.prototype.create=function(){this.hide();var t=this.game.data.texts;this.addText("Warning",t.Warning),this.addButton("Yes",t.Yes),this.addButton("No",t.No),this.sort()},i.prototype.changeLanguage=function(){this.text.text=this.game.data.texts.Warning[this.game.activeLanguage],this.modify("Yes",this.game.data.texts.Yes),this.modify("No",this.game.data.texts.No),this.sort()},i.prototype.sort=function(){this.text.y=0,this.text.x=this.game.width/2-this.text.width/2,this.buttons.Yes.y=1.5*this.text.height,this.buttons.Yes.x=this.buttons.Yes.width,this.buttons.No.y=1.5*this.text.height,this.buttons.No.x=this.game.width-2*this.buttons.No.width,this.container.y=this.game.height/2-this.container.height/2},i.prototype.mainMenu=function(){this.game.scenes.Title.mainMenu()},i.prototype.addText=function(t,i){this.text=new l(i[this.game.activeLanguage],this.game.settings.Text.ButtonStyle),this.container.addChild(this.text)},i}(y),S=function(t){function i(){t.apply(this,arguments)}return t&&(i.__proto__=t),(i.prototype=Object.create(t&&t.prototype)).constructor=i,i.prototype.build=function(){this.states={},this.addState("MainMenu",new v),this.addState("Options",new b),this.addState("Credits",new w),this.addState("Help",new x),this.addState("Warning",new I),this.addAction("MainMenu","Options",this.showOptions.bind(this)),this.addAction("MainMenu","Help",this.showHelp.bind(this)),this.addAction("MainMenu","Credits",this.showCredits.bind(this)),this.addAction("MainMenu","New",this.checkAdventure.bind(this)),this.addAction("MainMenu","Continue",this.loadAdventure.bind(this)),this.addAction("Warning","Yes",this.newAdventure.bind(this)),this.addAction("Warning","No",this.mainMenu.bind(this)),this.addAction("Options","Back",this.mainMenu.bind(this))},i.prototype.addAction=function(t,i,e){this.states[t].buttons[i].on("pointerup",e)},i.prototype.addState=function(t,i,e){this.states[t]=i,i.game=this.game,i.create(),this.container.addChild(this.states[t].container)},i.prototype.showOptions=function(){this.states.MainMenu.hide(),this.states.Options.show()},i.prototype.showHelp=function(){this.states.MainMenu.hide(),this.states.Help.show()},i.prototype.showCredits=function(){this.states.MainMenu.hide(),this.states.Credits.show()},i.prototype.mainMenu=function(){this.states.Credits.hide(),this.states.Options.hide(),this.states.Help.hide(),this.states.Warning.hide(),this.changeLanguage(),this.states.MainMenu.show()},i.prototype.changeLanguage=function(){this.states.MainMenu.changeLanguage(),this.states.Credits.changeLanguage(),this.states.Help.changeLanguage(),this.states.Warning.changeLanguage()},i.prototype.warning=function(){this.states.MainMenu.hide(),this.states.Warning.show()},i.prototype.checkAdventure=function(){void 0!==this.game.storage.progress?this.warning():this.newAdventure()},i.prototype.newAdventure=function(){this.game.storage.delete(),this.game.changeScene(this.game.settings.FirstScene),this.game.start()},i.prototype.loadAdventure=function(){this.game.storage.load(),this.game.changeScene(this.game.storage.progress.latestScene),this.game.start()},i}(g),T=function(t){function i(){t.apply(this,arguments)}return t&&(i.__proto__=t),(i.prototype=Object.create(t&&t.prototype)).constructor=i,i.prototype.build=function(){if(void 0!==this.foreground&&(this.foreground.parentLayer=this.game.layerTop),this.background.parentLayer=this.game.layerBottom,this.background.interactive=!0,this.background.buttonMode=!0,this.background.on("pointertap",this.getPosition.bind(this)),this.walkable=new n(this.game.width,this.game.height),void 0!==this.config.WalkArea&&this.walkable.addPolygon(this.config.WalkArea),void 0!==this.config.Obstacles){var t=Object.values(this.config.Obstacles);this.config.Obstacles=t;for(var i=0;i<this.config.Obstacles.length;i++)this.walkable.addPolygon(this.config.Obstacles[i])}var e=this.config.Objects;if(e)for(var s=0;s<e.length;s++)void 0!==this.game.objects[e[s]]?this.container.addChild(this.game.objects[e[s]].sprite):console.log("Error:Game object "+e[s]+" not found");var o=this.config.Characters;if(o)for(var a=0;a<o.length;a++)void 0!==this.game.npcs[o[a]]?this.container.addChild(this.game.npcs[o[a]].sprite):console.log("Error:Game character "+o[a]+" not found")},i.prototype.getPosition=function(t){var i=t.data.getLocalPosition(this.game.app.stage);this.game.player.lock||null!==this.game.activeObject||this.game.player.move(i)},i.prototype.getPath=function(t,i,e,s){return this.walkable.findPath(t,i,e,s,0)},i}(g),C=function(){this.container=new PIXI.Container,this.music=null,this.sequenceIndex=0,this.played=!1};function P(t,i){var e=t.getBounds(),s=i.getBounds();return e.x+e.width>s.x&&e.x<s.x+s.width&&e.y+e.height>s.y&&e.y<s.y+s.height}function k(t,i){var e;return null!=t&&null!=i&&(e=t.hitArea?o.ContainsPoint(t.hitArea.points,i.x,i.y):i.hitArea?o.ContainsPoint(i.hitArea.points,t.x,t.y):P(t,i)),e}C.prototype.build=function(){this.config.Video?(this.videoData=this.game.files.resources[this.config.Video].data,this.videoEnds=this.end.bind(this),this.videoData.addEventListener("ended",this.videoEnds)):this.config.Sequence&&(this.tween=null,this.image=new PIXI.Sprite(PIXI.Texture.from(this.config.Sequence[this.sequenceIndex].Image)),this.image.anchor.set(.5,0),this.container.interactive=!0,this.container.buttonMode=!0,this.container.on("pointertap",this.next.bind(this)),this.container.addChild(this.image),this.field=new PIXI.extras.BitmapText(this.config.Sequence[this.sequenceIndex].Text[this.game.activeLanguage],this.game.settings.Text.Style),this.field.anchor.set(.5,1),this.field.maxWidth=this.game.width,this.container.addChild(this.field))},C.prototype.show=function(){if(this.config.Video){var t=PIXI.Texture.from(this.videoData);this.videoSprite=new PIXI.Sprite(t),this.videoSprite.width=this.game.width,this.videoSprite.height=this.game.height,this.videoSprite.interactive=!0,this.videoSprite.buttonMode=!0,this.videoSprite.on("pointertap",this.end.bind(this)),this.container.addChild(this.videoSprite)}else this.config.Sequence&&(this.adjust(),this.sound());this.game.app.stage.addChild(this.container),this.fadeIn()},C.prototype.hide=function(){this.container.parent.removeChild(this.container)},C.prototype.next=function(){this.timeoutID&&clearTimeout(this.timeoutID),this.sequenceIndex<this.config.Sequence.length-1?(this.sequenceIndex+=1,this.field.text=this.config.Sequence[this.sequenceIndex].Text[this.game.activeLanguage],this.image.texture=PIXI.Texture.from(this.config.Sequence[this.sequenceIndex].Image),this.adjust(),this.fadeIn(),this.sound()):this.end()},C.prototype.fadeIn=function(){this.tween&&this.tween.kill(),this.tween=r.TweenMax.fromTo(this.container,1,{alpha:0},{alpha:1,onComplete:this.timer.bind(this)})},C.prototype.timer=function(){this.timeoutID=setTimeout(this.fadeOut.bind(this),1e3*this.config.Sequence[this.sequenceIndex].Time)},C.prototype.fadeOut=function(){this.tween&&this.tween.kill(),this.tween=r.TweenMax.fromTo(this.container,1,{alpha:1},{alpha:0,onComplete:this.next.bind(this)})},C.prototype.end=function(){this.game.activeCutscene=null,this.videoData&&(this.videoData.pause(),this.videoData.removeEventListener("ended",this.videoEnds)),this.tween&&this.tween.kill(),this.timeoutID&&clearTimeout(this.timeoutID),null!==this.music&&this.game.sound.stop(this.music),this.played=!0,this.hide(),this.game.finished?this.game.home():this.game.resume()},C.prototype.adjust=function(){var t=this.image.width/this.image.height;this.image.height=this.game.height-this.field.height,this.image.width=this.image.height*t,this.image.x=this.game.width/2,this.field.x=this.game.width/2,this.field.y=this.game.height,(this.container.width>this.game.width||this.container.height>this.game.height)&&this.scale(),this.center()},C.prototype.center=function(){this.container.x=this.game.width/2,this.container.y=this.game.height/2,this.container.pivot.x=this.container.width/2,this.container.pivot.y=this.container.height/2},C.prototype.scale=function(){var t=Math.min(this.game.width/this.container.width,this.game.height/this.container.height);this.container.scale.set(t)},C.prototype.sound=function(){void 0!==this.config.Sequence[this.sequenceIndex].Music&&this.game.playSounds&&(null!==this.music&&this.game.sound.stop(this.music),this.music=this.config.Sequence[this.sequenceIndex].Music,this.game.sound.play(this.music))};var j=function(){this.sprite=null,this.game=null,this.action=null};j.prototype.build=function(){if(void 0===this.config.Description&&(this.config.Description=this.game.data.texts.NoDescription),this.config.Texture)this.sprite=new PIXI.Sprite.from(PIXI.Texture.from(this.config.Texture));else if(this.config.Area)this.sprite=new PIXI.Sprite.from(PIXI.Texture.EMPTY),this.sprite.hitArea=new PIXI.Polygon(this.config.Area);else if(this.config.Animation){for(var t=this.game.files.resources[this.config.Animation.Name].spritesheet,i=[],e=0;e<t._frameKeys.length;e++)i.push(PIXI.Texture.from(t._frameKeys[e]));this.sprite=new PIXI.extras.AnimatedSprite(i),this.animationSpeed=this.config.Animation.Speed,this.play()}this.config.Position&&(this.sprite.x=this.config.Position[0],this.sprite.y=this.config.Position[1]),this.config.Size&&this.sprite.scale.set(this.config.Size),this.config.Mirror&&this.flip(),this.config.Area||this.sprite.anchor.set(.5,1),this.sprite.parentLayer="Top"===this.config.Layer?this.game.layerTop:"Bottom"===this.config.Layer?this.game.layerBottom:this.game.layer,this.config.Door&&(this.door=!0,this.newScene=this.config.Door.To,this.playerPos=this.config.Door.Player),this.holding=!1,this.config.Lock&&(this.locked=!0),this.sprite.interactive=!0,this.sprite.buttonMode=!0,void 0!==this.config.Area?this.sprite.on("pointerdown",this.touchArea.bind(this)).on("pointerup",this.releaseArea.bind(this)).on("pointerupoutside",this.releaseArea.bind(this)):this.sprite.on("pointerdown",this.touch.bind(this)).on("pointermove",this.move.bind(this)).on("pointerup",this.release.bind(this)).on("pointerupoutside",this.release.bind(this)),void 0!==this.config.Interactive&&this.setInteraction(this.config.Interactive)},j.prototype.hide=function(){this.sprite.visible=!1},j.prototype.show=function(){this.sprite.visible=!0},j.prototype.setpos=function(t,i){this.sprite.x=t,this.sprite.y=i},j.prototype.flip=function(){this.sprite.scale.x*=-1},j.prototype.changeTexture=function(t){this.sprite.texture=new PIXI.Texture.from(t)},j.prototype.hold=function(){this.holding=!0},j.prototype.touchArea=function(t){null!==this.game.activeObject||this.game.player.lock||(this.game.activeObject=this,this.interaction=t.data,this.action=null,this.timeoutID&&clearTimeout(this.timeoutID),this.timeoutID=setTimeout(this.hold.bind(this),this.game.holdTime),this.touchedPos=this.interaction.getLocalPosition(this.game.app.stage))},j.prototype.releaseArea=function(){if(this.timeoutID&&clearTimeout(this.timeoutID),this.interaction){var t=this.interaction.getLocalPosition(this.game.app.stage);k(t,this.sprite)&&(2===this.interaction.button||this.holding?(!0===this.door?(i=this.config.Area,e=t,s=Math.round(e.x),n=Math.round(e.y),a={},h=o.ClosestEdge(i,s,n),a.x=h.point.x-h.norm.x,a.y=h.point.y-h.norm.y,t={x:Math.round(a.x),y:Math.round(a.y)}):void 0!==this.config.Use&&(this.game.activePuzzle=this.game.puzzles[this.config.Use]),this.action="Use"):this.action="Look"),null!==this.action?(this.game.player.endAction=this.action,this.game.player.move(t)):this.cancel(),this.game.player.touched&&(this.game.player.touched=!1),this.holding=!1,this.interaction=null,this.touchedPos=null}var i,e,s,n,a,h},j.prototype.touch=function(t){null!==this.game.activeObject||this.game.player.lock||(this.game.activeObject=this,this.action=null,this.posX=this.sprite.x,this.posY=this.sprite.y,this.interaction=t.data,this.sprite.alpha=.5,this.dragging=!0,this.timeoutID&&clearTimeout(this.timeoutID),this.timeoutID=setTimeout(this.hold.bind(this),1e3),this.oldParent=this.sprite.parent,this.depthGroup=this.sprite.parentLayer,this.sprite.parentLayer!==this.game.layerUI&&(this.sprite.parentLayer=this.game.layerUI))},j.prototype.move=function(){if(this.dragging&&!this.locked){this.sprite.setParent(this.game.app.stage);var t=this.interaction.getLocalPosition(this.sprite.parent),i=this.sprite.getBounds();t.x>i.width/2&&t.x<this.game.width-i.width/2&&(this.sprite.x=t.x),t.y>i.height&&t.y<this.game.height&&(this.sprite.y=t.y)}},j.prototype.release=function(){if(this.timeoutID&&clearTimeout(this.timeoutID),this.interaction){var t={x:this.posX,y:this.posY};k(this.sprite,this.game.inventory.icon)&&this.config.Take?this.action="Take":2===this.interaction.button||this.holding?(void 0!==this.config.Use&&(this.game.activePuzzle=this.game.puzzles[this.config.Use]),this.action="Use"):this.action="Look",null!==this.action?(this.game.player.endAction=this.action,this.game.player.move(t)):this.cancel(),this.game.player.touched&&(this.game.player.touched=!1),this.sprite.x=this.posX,this.sprite.y=this.posY,this.sprite.alpha=1,this.sprite.parentLayer=this.depthGroup,this.sprite.setParent(this.oldParent),this.holding=!1,this.interaction=null,this.dragging=!1}},j.prototype.hit=function(){var t,i=null,e=this.game.activeScene.config.Objects;if(void 0!==e)for(t=0;t<e.length;t++)if(k(this.sprite,this.game.objects[e[t]].sprite)&&this.config.Name!==e[t]){i=e[t];break}for(e=this.game.inventory.objects,t=0;t<e.length;t++)if(k(this.sprite,this.game.objects[e[t]].sprite)&&this.config.Name!==e[t]){i=e[t];break}var s=this.game.activeScene.config.Characters;if(void 0!==s)for(t=0;t<s.length;t++)if(k(this.sprite,this.game.npcs[s[t]].sprite)&&this.config.Name!==s[t]){i=s[t];break}return i},j.prototype.cancel=function(){this.game.activeObject.action=null,this.game.activeObject=null},j.prototype.setInteraction=function(t){this.sprite.interactive=t},j.prototype.add=function(t){this.game.scenes[t].container.addChild(this.sprite),this.game.scenes[t].config.Objects.push(this.config.Name)},j.prototype.remove=function(){this.sprite.parent.removeChild(this.sprite);var t,i=Object.values(this.game.scenes),e=i.length;for(t=0;t<e;t++)if(void 0!==i[t].config.Objects&&i[t].config.Objects.includes(this.config.Name)){var s=i[t].config.Objects.indexOf(this.config.Name);i[t].config.Objects.splice(s,1)}this.game.inventory.objects.includes(this.config.Name)&&this.game.inventory.remove(this.config.Name)};var O=function(){this.container=new PIXI.Container,this.container.visible=!1,this.game=null,this.objects=[]};O.prototype.build=function(){this.background=new PIXI.Sprite(PIXI.Texture.from(this.game.settings.Inventory.Background)),this.background.width=this.game.width/2,this.background.height=this.game.height/2,this.background.parentLayer=this.game.layerUI,this.container.x=(this.game.width-this.background.width)/2,this.container.y=(this.game.height-this.background.height)/2,this.border=10,this.icon=new PIXI.Sprite(PIXI.Texture.from(this.game.settings.Inventory.Icon)),this.icon.on("pointertap",this.click.bind(this)),this.icon.interactive=!0,this.icon.buttonMode=!0,this.setIcon(this.game.settings.Inventory.Position),this.container.addChild(this.background),this.icon.parentLayer=this.game.layerUI,this.hide(),this.hideIcon()},O.prototype.show=function(){this.update(),this.container.visible=!0},O.prototype.hide=function(){this.container.visible=!1},O.prototype.showIcon=function(){this.icon.visible=!0},O.prototype.hideIcon=function(){this.icon.visible=!1},O.prototype.setIcon=function(t){"bottom-right"==t?(this.icon.x=this.game.width-this.icon.width,this.icon.y=this.game.height-this.icon.height):"top-right"==t?(this.icon.x=this.game.width-this.icon.width,this.icon.y=0):"top-left"==t?(this.icon.x=0,this.icon.y=this.game.height-this.icon.height):"bottom-top"==t&&(this.icon.x=this.game.width-this.icon.width,this.icon.y=0)},O.prototype.click=function(){this.container.visible?this.hide():this.game.player.lock||this.show()},O.prototype.add=function(t){this.objects.push(t),this.game.objects[t].sprite.setParent(this.container),this.game.objects[t].sprite.parentLayer=this.game.layerUI,this.game.objects[t].sprite.on("pointermove",this.move.bind(this.game.objects[t])).off("pointerup").off("pointerupoutside").on("pointerup",this.release.bind(this.game.objects[t])).on("pointerupoutside",this.release.bind(this.game.objects[t])),this.update()},O.prototype.remove=function(t){this.objects.includes(t)&&(this.objects.splice(this.objects.indexOf(t),1),this.update())},O.prototype.update=function(){var t,i=this.objects.length;for(t=0;t<i;t++){var e=this.game.objects[this.objects[t]].sprite,s=Math.min((this.container.width/5-.05*this.container.width)/e.width,(this.container.height/5-.05*this.container.height)/e.height);e.width*=s,e.height*=s,e.x=t%5*this.container.width/5+this.border-t+e.width/2,e.y=Math.floor(t/5)*this.container.height/5+this.border-t+e.height,this.container.width=this.background.width,this.container.height=this.background.height}},O.prototype.move=function(){P(this.sprite,this.game.inventory.container)||this.game.inventory.hide()},O.prototype.release=function(t){if(this.timeoutID&&clearTimeout(this.timeoutID),this.interaction){var i=this.hit(),e={x:this.sprite.x,y:this.sprite.y};this.holding?void 0!==this.config.Combine&&null!==i&&(this.config.Combine.With===i&&(this.game.activePuzzle=this.game.puzzles[this.config.Combine.Puzzle]),this.action="Use"):this.game.player.say(this.config.Description[this.game.activeLanguage]),null!==this.action?(this.game.player.endAction=this.action,this.game.player.move(e)):this.cancel(),this.sprite.x=this.posX,this.sprite.y=this.posY,this.sprite.alpha=1,this.sprite.setParent(this.oldParent),this.interaction=null,this.dragging=!1,this.holding=!1}};var M=function(){this.solved=!1};M.prototype.resolve=function(){if(null!==this.game.activeObject&&this.game.activeObject.cancel(),this.solved)this.game.player.stop();else{if(this.config.ModifyObject){var t=this.game.objects[this.config.ModifyObject.Name];void 0!==this.config.ModifyObject.Description&&(t.config.Description=this.config.ModifyObject.Description),void 0!==this.config.ModifyObject.Door&&this.createDoor(t),void 0!==this.config.ModifyObject.Position&&t.setpos(this.config.ModifyObject.Position[0],this.config.ModifyObject.Position[1]),this.config.ModifyObject.Mirror&&t.flip(),void 0!==this.config.ModifyObject.Interactive&&this.setInteraction(this.config.ModifyObject.Interactive),void 0!==this.config.ModifyObject.Texture&&this.changeTexture(this.config.ModifyObject.Texture),void 0!==this.config.ModifyObject.Combine&&(t.config.Combine=this.config.ModifyObject.Combine),void 0!==this.config.ModifyObject.Use&&(t.config.Use=this.config.ModifyObject.Use),void 0!==this.config.ModifyObject.Lock&&(t.lock=this.config.ModifyObject.Lock)}void 0!==this.config.GetObject&&this.game.inventory.add(this.config.GetObject),void 0!==this.config.AddObject&&this.game.objects[this.config.AddObject.Name].add(this.config.AddObject.Scene),void 0!==this.config.RemoveObject&&this.game.objects[this.config.RemoveObject].remove(),void 0!==this.config.RemoveDoor&&(this.game.objects[this.config.RemoveDoor].door=!1),void 0!==this.config.SetDialogue&&(this.game.npcs[this.config.SetDialogue.Character].config.Dialogue=this.config.SetDialogue.Dialogue),void 0!==this.config.Resolve&&this.game.puzzles[this.config.Resolve].resolve(),this.config.Say&&!this.game.silentMode?this.game.player.say(this.config.Say[this.game.activeLanguage]):this.config.NPCSay&&!this.game.silentMode?this.game.npcs[this.config.NPCSay.Name].say(this.config.NPCSay.Text[this.game.activeLanguage]):this.game.player.stop(),void 0===this.config.Sound||this.game.silentMode||this.game.sounds.play(this.config.Sound),void 0!==this.config.CutScene&&!this.game.silentMode&&this.game.playSounds&&(this.game.activeCutscene=this.game.cutscenes[this.config.CutScene],this.game.pause(),this.game.activeCutscene.show()),void 0===this.config.EndGame||this.game.silentMode||(this.game.end(),void 0!==this.config.EndGame.CutScene?(this.game.activeCutscene=this.game.cutscenes[this.config.EndGame.CutScene],this.game.pause(),this.game.activeCutscene.show()):this.game.home()),this.solved=!0}this.game.activePuzzle=null},M.prototype.createDoor=function(t){t.door=!0,t.newScene=this.config.ModifyObject.Door.To,t.playerPos=this.config.ModifyObject.Door.Player};var L=a.PixiFactory.factory,D=function(){this.game=null,this.state=null,this.lock=!1,this.endAction=null};D.prototype.setup=function(t){L.parseDragonBonesData(this.game.files.resources[t.Name+"Skeleton"].data),L.parseTextureAtlasData(this.game.files.resources[t.Name+"Json"].data,this.game.files.resources[t.Name+"Tex"].texture),this.sprite=L.buildArmatureDisplay(t.Armature),void 0!==t.Size?(this.size=t.Size,this.sprite.scale.set(this.size)):this.size=1,this.tween=null,this.animations=null!=t.Animations?t.Animations:{Stand:"stand",Walk:"walk",Take:"take",Use:"use",Say:"speak"},this.animate(this.animations.Stand),this.state="stand",t.Position&&(this.sprite.x=t.Position[0],this.sprite.y=t.Position[1]),this.sprite.parentLayer=this.game.layer,this.config=t},D.prototype.hide=function(){this.sprite.visible=!1},D.prototype.show=function(){this.sprite.visible=!0},D.prototype.position=function(t){this.sprite.x=t[0],this.sprite.y=t[1]},D.prototype.move=function(t){var i=t,e=function(t,i,e){var s,n=Math.round(t.x),a=Math.round(t.y),h={};if(o.ContainsPoint(e,n,a)){if(void 0!==i)for(var r=0;r<i.length;r++)if(o.ContainsPoint(i[r],n,a)){var c=o.ClosestEdge(e,n,a);h.x=c.point.x-c.norm.x,h.y=c.point.y-c.norm.y,s={x:Math.round(h.x)+1,y:Math.round(h.y)+1};break}}else{var d=o.ClosestEdge(e,n,a);h.x=d.point.x-d.norm.x,h.y=d.point.y-d.norm.y,s={x:Math.round(h.x),y:Math.round(h.y)}}return s}(t,this.game.activeScene.config.Obstacles,this.game.activeScene.config.WalkArea);e&&(i=e);var s,n=this.game.activeScene.walkable.findPath(this.sprite.x,this.sprite.y,i.x,i.y,0),a=[];for(s=0;s<n.length;s++)a.push({x:n[s],y:n[s+1]}),s++;if(a.length>0){var h=Math.abs(this.sprite.x-i.x)+Math.abs(this.sprite.y-i.y);h/=this.game.width+this.game.height,h*=10,void 0!==this.config.Speed&&(h/=this.config.Speed),this.animate(this.animations.Walk),this.sprite.armature.flipX=!(this.sprite.x<i.x),this.game.activeState=this,null!==this.tween&&this.tween.kill(),this.tween=r.TweenMax.to(this.sprite,h,{bezier:a,ease:Linear.easeNone,onComplete:this.stop.bind(this)})}},D.prototype.update=function(){this.scale()},D.prototype.scale=function(){var t=this.sprite.y/this.game.height*this.size;t<this.game.activeScene.config.Depth&&(t=this.game.activeScene.config.Depth),this.sprite.scale.set(t)},D.prototype.stop=function(){this.animate(this.animations.Stand),this.game.activeState=null,this.lock=!1,null!==this.endAction&&("Look"===this.endAction?this.look():"Take"===this.endAction?this.take():"Use"===this.endAction?this.use():"Talk"===this.endAction&&this.talk(),this.endAction=null)},D.prototype.say=function(t){this.game.textField.talker=this,this.game.textField.setText(t),this.game.textField.setAvatar(this.config.Avatar),void 0!==this.config.Color&&this.game.textField.setColor(Number(this.config.Color)),this.game.textField.setFont(void 0!==this.config.Font?this.config.Font:this.game.settings.Text.Style.font),this.game.textField.show(),this.animate(this.animations.Say),this.timeoutID&&clearTimeout(this.timeoutID),this.timeoutID=setTimeout(this.game.textField.end.bind(this.game.textField),this.game.textField.timeOut())},D.prototype.shutup=function(){this.animate(this.animations.Stand)},D.prototype.animate=function(t,i){this.sprite.animation.lastAnimationName!==t&&this.sprite.animation.fadeIn(t,.25,i)};var z=h.dragonBones.EventObject,A=function(t){function i(){t.apply(this,arguments)}return t&&(i.__proto__=t),(i.prototype=Object.create(t&&t.prototype)).constructor=i,i.prototype.setup=function(i){t.prototype.setup.call(this,i),this.hide()},i.prototype.checkDirection=function(t){void 0===t.config.Area&&(this.sprite.armature.flipX=!(this.sprite.x<t.sprite.x))},i.prototype.say=function(i){t.prototype.say.call(this,i),this.lock=!0},i.prototype.look=function(){null!==this.game.activeObject?(this.checkDirection(this.game.activeObject),this.say(this.game.activeObject.config.Description[this.game.activeLanguage]),this.game.activeObject.cancel()):null!==this.game.activeNPC&&(this.checkDirection(this.game.activeNPC),this.say(this.game.activeNPC.config.Description[this.game.activeLanguage]),this.game.activeNPC.cancel())},i.prototype.take=function(){this.lock=!0,this.animate(this.animations.Take,1),this.sprite.once(z.COMPLETE,this.takeEnd,this)},i.prototype.takeEnd=function(){if(null!==this.game.activeObject){var t=this.game.activeObject.config.Name;if(null!==this.game.activeScene&&this.game.activeScene.config.Objects.includes(t)){var i=this.game.activeScene.config.Objects.indexOf(t);this.game.activeScene.config.Objects.splice(i,1)}this.game.inventory.add(t),this.game.activeObject.cancel(),this.stop()}},i.prototype.use=function(){this.lock=!0,this.animate(this.animations.Use,1),this.sprite.once(z.COMPLETE,this.useEnd,this)},i.prototype.useEnd=function(){null!==this.game.activePuzzle?this.game.activePuzzle.resolve():null!==this.game.activeObject&&(this.game.activeObject.door?(this.game.changeScene(this.game.activeObject.newScene,this.game.activeObject.playerPos),this.stop()):this.say(this.game.data.texts.NotUsable[this.game.activeLanguage]),this.game.activeObject.cancel())},i.prototype.talk=function(){this.sprite.x<this.game.activeNPC.sprite.x?(this.sprite.armature.flipX=!1,this.game.activeNPC.sprite.armature.flipX=void 0===this.game.activeNPC.config.Mirror):(this.sprite.armature.flipX=!0,this.game.activeNPC.sprite.armature.flipX=void 0!==this.game.activeNPC.config.Mirror),this.game.activeDialogue.start()},i}(D),N=function(t){function i(){t.apply(this,arguments)}return t&&(i.__proto__=t),(i.prototype=Object.create(t&&t.prototype)).constructor=i,i.prototype.build=function(){void 0!==this.config.Mirror&&(this.sprite.armature.flipX=!0),this.holding=!1,this.sprite.interactive=!0,this.sprite.buttonMode=!0,this.sprite.on("pointerdown",this.touch.bind(this)).on("pointerup",this.release.bind(this)).on("pointerupoutside",this.release.bind(this))},i.prototype.hold=function(){this.holding=!0},i.prototype.touch=function(t){null!==this.game.activeNPC||this.game.player.lock||(this.game.activeNPC=this,this.action=null,this.interaction=t.data,this.pressTimeoutID&&clearTimeout(this.pressTimeoutID),this.pressTimeoutID=setTimeout(this.hold.bind(this),this.game.holdTime))},i.prototype.release=function(){if(this.pressTimeoutID&&clearTimeout(this.pressTimeoutID),this.interaction){var t;t=this.game.player.sprite.x<this.sprite.x?-1*this.sprite.getBounds().width:this.sprite.getBounds().width;var i={x:this.sprite.x+t,y:this.sprite.y};2===this.interaction.button||this.holding?void 0!==this.config.Dialogue&&(this.game.activeDialogue=this.game.dialogues[this.config.Dialogue],this.action="Talk"):this.action="Look",null!==this.action?(this.game.player.endAction=this.action,this.game.player.move(i)):this.cancel(),this.game.player.touched&&(this.game.player.touched=!1),this.holding=!1,this.interaction=null,this.dragging=!1,this.moved=0}},i.prototype.look=function(){this.action=this.game.player.look.bind(this.game.player)},i.prototype.cancel=function(){this.game.activeNPC.action=null,this.game.activeNPC=null},i}(D),B=function(){this.timeoutID=null,this.firstTime=!0,this.choice=null,this.branches={}};B.prototype.setup=function(t){var i;for(this.config=t,length=this.config.Branches.length,i=0;i<length;i++)this.branches[this.config.Branches[i].Name]=this.config.Branches[i];this.currentBranch=this.branches[this.config.DefaultBranch]},B.prototype.start=function(){this.firstTime=!1,this.game.player.lock=!0,this.game.textField.show(),this.game.textField.hideAvatar(),this.game.textField.Choices.get()},B.prototype.next=function(){if(null!==this.choice){var t=this.currentBranch.Choices[this.choice];this.game.textField.Choices.hide(),this.game.player.say(t.Text[this.game.activeLanguage])}else this.game.textField.hideAvatar(),this.game.textField.Choices.get()},B.prototype.searchBranch=function(t){var i,e=-1,s=this.config.Branches.length;for(i=0;i<s;i++)if(this.config.Branches[i].Name===t){e=i;break}return e},B.prototype.answer=function(){var t=this.currentBranch.Choices[this.choice];this.game.activeNPC.say(t.Answer[this.game.activeLanguage]),t.Link?this.currentBranch=this.branches[t.Link]:t.Puzzle?(t.Repeat=!1,this.end(),this.game.puzzles[t.Puzzle].resolve()):t.EndDialogue&&this.end(),this.choice=null},B.prototype.end=function(){this.game.activeNPC=null,this.game.activeDialogue=null},B.prototype.timeOut=function(){this.next()};var X=function(t){this.game=t,this.index=0,this.timeoutID=null,this.tween=null,this.image=new PIXI.Sprite(PIXI.Texture.from(this.game.settings.Logos[this.index])),this.image.anchor.set(.5,.5),this.image.position.set(this.game.width/2,this.game.height/2),this.image.interactive=!0,this.image.buttonMode=!0,this.image.on("pointertap",this.fadeOut.bind(this)),this.image.alpha=0};X.prototype.show=function(){this.game.app.stage.addChild(this.image),this.fadeIn()},X.prototype.fadeIn=function(){this.tween&&this.tween.kill(),this.tween=r.TweenMax.set(this.image,{alpha:0}),this.tween=r.TweenMax.fromTo(this.image,1,{alpha:0},{alpha:1,onComplete:this.timer.bind(this)})},X.prototype.timer=function(){this.timeoutID=setTimeout(this.fadeOut.bind(this),3e3)},X.prototype.fadeOut=function(){this.image.interactive=!1,this.tween&&this.tween.kill(),this.tween=r.TweenMax.fromTo(this.image,1,{alpha:1},{alpha:0,onComplete:this.next.bind(this)})},X.prototype.next=function(){this.image.interactive=!0,this.timeoutID&&clearTimeout(this.timeoutID),this.index++,void 0!==this.game.settings.Logos[this.index]?(this.image.texture=PIXI.Texture.from(this.game.settings.Logos[this.index]),this.fadeIn()):this.end()},X.prototype.end=function(){this.timeoutID&&clearTimeout(this.timeoutID),this.tween&&this.tween.kill(),this.game.app.stage.removeChild(this.image),this.game.setScene(this.game.titleLabel),this.game.fadeIn()};var E=function(t){this.settings={},this.data={scenes:[],cutscenes:[],objects:[],dialogues:[],puzzles:[],credits:[],texts:[]},this.width=t.width,this.height=t.height,this.holdTime=500,this.playSounds=!0,this.app=new i.Application(t.width,t.height,{antialias:!0,autoResize:!0,resolution:devicePixelRatio}),this.app.stage=new i.display.Stage,void 0!==t.autoResize?this.app.renderer.autoResize=t.autoResize:window.addEventListener("resize",this.resize.bind(this)),document.addEventListener("contextmenu",function(t){t.preventDefault()}),t.parent?document.getElementById(t.parent).appendChild(this.app.view):document.body.appendChild(this.app.view),this.preload(t.files)};E.prototype.preload=function(t){this.progressBar=new i.Graphics,this.progressBar.beginFill(14561865),this.progressBar.drawRect(0,0,this.width,this.height/50),this.progressBar.endFill(),this.progressBar.width=0,this.loadingTxt=new i.Text("Loading...",{fill:"white",fontSize:50}),this.loadingTxt.anchor.set(.5),this.loadingTxt.x=this.width/2,this.loadingTxt.y=this.height/2,this.progressBar.y=this.height-this.loadingTxt.height,this.app.stage.addChild(this.loadingTxt),this.app.stage.addChild(this.progressBar),this.resize(),this.jsons=new c,this.jsons.game=this,this.jsons.addJSON(t),this.jsons.load(this.load.bind(this))},E.prototype.load=function(){this.files=new c,this.files.game=this,this.files.addFiles(Object.values(this.jsons.resources)),this.files.load(this.setup.bind(this))},E.prototype.setup=function(){var t;this.app.stage.removeChild(this.loadingTxt),this.app.stage.removeChild(this.progressBar),this.addZOrder(),this.resize(),this.tween=null,this.logo=null,this.sounds=null,this.scenes={},this.cutscenes={},this.objects={},this.npcs={},this.dialogues={},this.puzzles={},this.activeLanguage=0,this.activeScene=null,this.activeObject=null,this.activeNPC=null,this.activePuzzle=null,this.activeDialogue=null,this.activeCutscene=null,this.activeState=null,this.finished=!1,this.storage=new d(this),this.logo=new X(this),this.sound=new p(this),this.titleLabel="Title",void 0!==this.settings.HoldTime&&(this.holdTime=1e3*this.settings.HoldTime),this.dialogueChoices=void 0!==this.settings.dialogueChoices?this.settings.dialogueChoices:3,this.addScene(this.titleLabel,new S,this.settings.TitleScreen);var i=this.data.objects.length;for(t=0;t<i;t++)this.addObject(this.data.objects[t].Name,new j,this.data.objects[t]);for(i=this.data.npc.length,t=0;t<i;t++)this.addNPC(this.data.npc[t].Name,new N,this.data.npc[t]);for(i=this.data.dialogues.length,t=0;t<i;t++)this.addDialogue(this.data.dialogues[t].Name,new B,this.data.dialogues[t]);for(i=this.data.scenes.length,t=0;t<i;t++)this.addScene(this.data.scenes[t].Name,new T,this.data.scenes[t]);for(i=this.data.cutscenes.length,t=0;t<i;t++)this.addCutscene(this.data.cutscenes[t].Name,new C,this.data.cutscenes[t]);for(i=this.data.puzzles.length,t=0;t<i;t++)this.addPuzzle(this.data.puzzles[t].Name,new M,this.data.puzzles[t]);this.addInventory(),this.addTextField(),this.addPlayer(),this.storage.check(),this.addBlackScreen(),this.app.ticker.add(this.loop.bind(this)),this.logo.show()},E.prototype.loop=function(t){null!=this.activeState&&this.activeState.update(t)},E.prototype.addObject=function(t,i,e){this.objects[t]=i,i.config=e,i.game=this,i.build()},E.prototype.addScene=function(t,i,e){this.scenes[t]=i,i.setup(e),i.game=this,i.build()},E.prototype.addCutscene=function(t,i,e){this.cutscenes[t]=i,i.config=e,i.game=this,i.build()},E.prototype.addPuzzle=function(t,i,e){this.puzzles[t]=i,i.config=e,i.game=this},E.prototype.addZOrder=function(){this.BottomGroup=new i.display.Group(0,!1),this.sortGroup=new i.display.Group(1,!0),this.sortGroup.on("sort",function(t){t.zOrder=-t.y}),this.TopGroup=new i.display.Group(2,!1),this.UIGroup=new i.display.Group(3,!1),this.layerBottom=new i.display.Layer(this.BottomGroup),this.layer=new i.display.Layer(this.sortGroup),this.layerTop=new i.display.Layer(this.TopGroup),this.layerUI=new i.display.Layer(this.UIGroup),this.app.stage.group.enableSort=!0,this.app.stage.addChild(this.layerBottom),this.app.stage.addChild(this.layer),this.app.stage.addChild(this.layerTop),this.app.stage.addChild(this.layerUI)},E.prototype.addInventory=function(){this.inventory=new O,this.inventory.game=this,this.inventory.build()},E.prototype.addPlayer=function(){this.player=new A,this.player.game=this,this.data.player.Name="player",this.player.setup(this.data.player)},E.prototype.addNPC=function(t,i,e){this.npcs[t]=i,i.game=this,i.setup(e),i.build()},E.prototype.addDialogue=function(t,i,e){this.dialogues[t]=i,i.game=this,i.setup(e)},E.prototype.addTextField=function(){this.textField=new f,this.textField.game=this,this.textField.build()},E.prototype.addBlackScreen=function(){this.blackScreen=new i.Sprite(i.Texture.WHITE),this.blackScreen.width=this.width,this.blackScreen.height=this.height,this.blackScreen.tint=0,this.blackScreen.parentLayer=this.layerUI},E.prototype.resize=function(){var t=window.innerWidth,i=window.innerHeight,e=Math.min(t/this.width,i/this.height);this.app.renderer.resize(this.width*e,this.height*e),this.app.stage.scale.set(e)},E.prototype.start=function(){this.app.stage.addChild(this.inventory.container),this.app.stage.addChild(this.inventory.icon),this.app.stage.addChild(this.player.sprite),this.app.stage.addChild(this.textField.container)},E.prototype.pause=function(){this.activeScene.hide(),this.inventory.hide(),this.inventory.hideIcon(),this.player.hide(),void 0!==this.activeScene.music&&this.sound.stop(this.activeScene.music)},E.prototype.resume=function(){this.inventory.showIcon(),this.player.show(),this.activeScene.show(),this.fadeIn()},E.prototype.end=function(){this.finished=!0},E.prototype.home=function(){location.reload()},E.prototype.setScene=function(t,i){null!==this.activeScene&&this.app.stage.removeChild(this.activeScene.container),this.activeScene=this.scenes[t],void 0!==i&&(this.player.sprite.x=i[0],this.player.sprite.y=i[1]),void 0!==this.activeScene.config.Player&&(void 0!==this.activeScene.config.Player.Position&&this.player.position(this.activeScene.config.Player.Position),void 0!==this.activeScene.config.Player.Size&&(this.player.size=this.activeScene.config.Player.Size,this.player.scale())),this.activeScene!==this.scenes[this.titleLabel]&&this.storage.save()},E.prototype.changeScene=function(t,i){void 0!==this.activeScene.music&&this.sound.stop(this.activeScene.music),this.app.stage.addChild(this.blackScreen),this.tween&&this.tween.kill(),this.tween=r.TweenMax.set(this.blackScreen,{alpha:0}),this.tween=r.TweenMax.fromTo(this.blackScreen,1,{alpha:0},{alpha:1,onComplete:this.fadeOutEnd.bind(this),onCompleteParams:[t,i]})},E.prototype.fadeIn=function(){this.app.stage.addChild(this.activeScene.container),this.app.stage.addChild(this.blackScreen),this.tween&&this.tween.kill(),this.tween=r.TweenMax.set(this.blackScreen,{alpha:1}),this.tween=r.TweenMax.fromTo(this.blackScreen,1,{alpha:1},{alpha:0,onComplete:this.fadeInEnd.bind(this)})},E.prototype.fadeInEnd=function(){this.app.stage.removeChild(this.blackScreen),void 0!==this.activeScene.music&&this.playSounds&&this.sound.play(this.activeScene.music)},E.prototype.fadeOutEnd=function(t,i){this.setScene(t,i),void 0===this.activeScene.config.CutScene||this.cutscenes[this.activeScene.config.CutScene].played?this.resume():(this.activeCutscene=this.cutscenes[this.activeScene.config.CutScene],this.activeCutscene.show()),this.app.stage.removeChild(this.blackScreen)},console.log("JSGAM 5.0.0 https://github.com/kreezii/jsgam"),module.exports=E;
//# sourceMappingURL=jsgam.js.map
