!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i(require("pixi.js"),require("pixi-layers"),require("pixi-multistyle-text"),require("pixi-sound"),require("walkable"),require("polyk"),require("k8w-pixi-tween"),require("dragonbones-pixi")):"function"==typeof define&&define.amd?define(["pixi.js","pixi-layers","pixi-multistyle-text","pixi-sound","walkable","polyk","k8w-pixi-tween","dragonbones-pixi"],i):t.jsgam=i(t.PIXI$1,0,t.MultiStyleText,0,t.walkable,t.polyk,t.k8wPixiTween,t.dragonBones)}(this,function(t,i,e,s,n,o,a,h){e=e&&e.hasOwnProperty("default")?e.default:e,n=n&&n.hasOwnProperty("default")?n.default:n,a=a&&a.hasOwnProperty("default")?a.default:a,h=h&&h.hasOwnProperty("default")?h.default:h;var r=function(t){function i(){t.call(this),this.game=null,this.onLoad.add(this.update.bind(this)),this.onError.add(this.error.bind(this))}return t&&(i.__proto__=t),(i.prototype=Object.create(t&&t.prototype)).constructor=i,i.prototype.addJSON=function(t){var i,e=t.length;for(i=0;i<e;i++){var s=t[i].slice(t[i].lastIndexOf("/")+1,t[i].lastIndexOf("."));this.add(s,t[i])}},i.prototype.addFiles=function(t){var i,e=t.length;for(i=0;i<e;i++){if(t[i].data.Settings&&(this.game.settings=t[i].data.Settings),t[i].data.Scenes&&(this.game.data.scenes=t[i].data.Scenes),t[i].data.Cutscenes&&(this.game.data.cutscenes=t[i].data.Cutscenes),t[i].data.Objects&&(this.game.data.objects=t[i].data.Objects),t[i].data.Dialogues&&(this.game.data.dialogues=t[i].data.Dialogues),t[i].data.Puzzles&&(this.game.data.puzzles=t[i].data.Puzzles),t[i].data.Credits&&(this.game.data.credits=t[i].data.Credits),t[i].data.Texts&&(this.game.data.texts=t[i].data.Texts),t[i].data.Sounds)for(var s=t[i].data.Sounds,n=0;n<s.length;n++){var o=s[n].Src;null!==o&&this.add(s[n].Name,o)}if(t[i].data.Vids){this.fixVidLoad();for(var a=t[i].data.Vids,h=0;h<a.length;h++){var r=a[h].Src;null!==r&&this.add(a[h].Name,r)}}if(t[i].data.Animations)for(var c=t[i].data.Animations,d=0;d<c.length;d++){var p=c[d].Src;null!==p&&this.add(c[d].Name,p)}if(t[i].data.Backgrounds)for(var u=t[i].data.Animations,g=0;g<u.length;g++){var l=u[g].Src;null!==l&&this.add(u[g].Name,l)}if(t[i].data.Player&&(this.add("playerTex",t[i].data.Player.Texture).add("playerJson",t[i].data.Player.Json).add("playerSkeleton",t[i].data.Player.Skeleton),this.game.data.player=t[i].data.Player),t[i].data.Characters){for(var m=t[i].data.Characters,f=0;f<m.length;f++)this.add(m[f].Name+"Tex",m[f].Texture).add(m[f].Name+"Json",m[f].Json).add(m[f].Name+"Skeleton",m[f].Skeleton);this.game.data.npc=t[i].data.Characters}}},i.prototype.fixVidLoad=function(){PIXI.sound.utils.extensions.splice(PIXI.sound.utils.extensions.indexOf("mp4"),1),PIXI.loaders.Resource.setExtensionXhrType("mp4",void 0),PIXI.loaders.Resource.setExtensionLoadType("mp4",PIXI.loaders.Resource.LOAD_TYPE.VIDEO)},i.prototype.update=function(){var t=Math.floor(this.progress);this.game.loadinProgress.text=t+"%"},i.prototype.error=function(t){console.log(t)},i}(PIXI.loaders.Loader),c=function(){this.container=new PIXI.Container,this.game=null};c.prototype.setup=function(t){this.background=new PIXI.Sprite(PIXI.Texture.from(t.Background)),this.background.anchor.set(0),this.container.addChild(this.background),this.music=t.Music,this.config=t},c.prototype.update=function(t){},c.prototype.hide=function(){this.container.visible=!1},c.prototype.show=function(){this.container.visible=!0};var d=function(t){function i(i,e){t.call(this,i,e),this.interactive=!0,this.buttonMode=!0}return t&&(i.__proto__=t),(i.prototype=Object.create(t&&t.prototype)).constructor=i,i}(PIXI.Text),p=function(){this.container=new PIXI.Container,this.Background=null,this.Text=null,this.container.visible=!1};p.prototype.build=function(){this.container.parentLayer=this.game.layerUI,this.Background=new PIXI.Sprite(PIXI.Texture.WHITE);var t=4;void 0!==this.game.settings.Text.Size&&("fourth"===this.game.settings.Text.Size?t=4:"half"===this.game.settings.Text.Size&&(t=2)),this.Background.width=this.game.width,this.Background.height=this.game.height/t,this.Background.tint="black",this.Background.alpha=.5,this.Text=new d("",this.game.settings.Text.Style),this.Text.anchor.set(.5,0),this.Text.x=this.game.width/2,this.Text.y=0,this.Text.on("pointertap",this.skip.bind(this)),this.container.addChild(this.Background),this.container.addChild(this.Text),void 0!==this.game.settings.Text.Position&&this.setPosition(this.game.settings.Text.Position)},p.prototype.show=function(){this.container.visible=!0},p.prototype.hide=function(){this.container.visible=!1},p.prototype.end=function(){this.setText(""),this.hide(),this.game.player.stop()},p.prototype.skip=function(){this.end(),this.talker&&clearTimeout(this.talker.timeoutID)},p.prototype.setPosition=function(t){"top"===t?(this.container.x=0,this.container.y=0):"bottom"===t&&(this.container.x=0,this.container.y=this.game.height-this.container.height)},p.prototype.setText=function(t){this.Text.text=t,(this.Text.width>this.container.width||this.Text.height>this.container.height)&&this.adjustText()},p.prototype.adjustText=function(){var t=Math.min(this.container.width/this.Text.width,this.container.height/this.Text.height);this.container.scale.set(.95*t)},p.prototype.countWords=function(t){return t.split(" ").length},p.prototype.timeOut=function(){var t;return(t=void 0!==this.game.settings.Text.Speed?this.game.settings.Text.Speed:this.countWords(this.Text.text)/3)<1&&(t=1),1e3*t},p.prototype.setColor=function(t){this.Text.tint=t};var u=function(){this.container=new PIXI.Container,this.game=null,this.buttons={}};u.prototype.addButton=function(t,i){this.buttons[t]=new d(i[this.game.activeLanguage],this.game.settings.Text.ButtonStyle),this.container.addChild(this.buttons[t])},u.prototype.modify=function(t,i){this.buttons[t].text=i[this.game.activeLanguage]},u.prototype.disable=function(t){this.buttons[t].alpha=.5,this.buttons[t].interactive=!1},u.prototype.enable=function(t){this.buttons[t].alpha=1,this.buttons[t].interactive=!0},u.prototype.sortMenu=function(){var t,i=Object.values(this.buttons),e=i.length;for(i[0].y=0,t=1;t<e;t++)i[t].y=i[t-1].y+1.5*i[t-1].height,i[t].x=this.container.width/2-i[t].width/2;this.center()},u.prototype.resize=function(){var t=Math.min(this.game.width/this.container.width,this.game.height/this.container.height);console.log(t),this.container.scale.set(.95*t)},u.prototype.hide=function(){this.container.visible=!1},u.prototype.show=function(){this.container.visible=!0},u.prototype.center=function(){this.container.x=this.game.width/2,this.container.y=this.game.height/2,this.container.pivot.x=this.container.width/2,this.container.pivot.y=this.container.height/2};var g=function(t){function i(){t.apply(this,arguments)}return t&&(i.__proto__=t),(i.prototype=Object.create(t&&t.prototype)).constructor=i,i.prototype.create=function(){var t=this.game.data.texts;this.addButton("New",t.NewGame),this.addButton("Continue",t.Continue),this.addButton("Options",t.Options),this.addButton("Help",t.Help),this.addButton("Credits",t.Credits),this.disable("Continue"),this.sortMenu()},i.prototype.changeLanguage=function(){this.modify("New",this.game.data.texts.NewGame),this.modify("Continue",this.game.data.texts.Continue),this.modify("Options",this.game.data.texts.Options),this.modify("Credits",this.game.data.texts.Credits),this.sortMenu()},i}(u),l=function(t){function i(){t.apply(this,arguments)}return t&&(i.__proto__=t),(i.prototype=Object.create(t&&t.prototype)).constructor=i,i.prototype.create=function(){this.container.visible=!1;for(var t=this.game.settings.Languages,i=0;i<t.length;i++)this.addLanguage(t[i]),this.buttons[t[i]].on("pointerup",this.setLanguage);Object.values(this.buttons)[this.game.activeLanguage].tint="0xFF0000",this.addButton("Back",this.game.data.texts.Back),this.sortMenu()},i.prototype.addLanguage=function(t){this.buttons[t]=new d(t,this.game.settings.Text.ButtonStyle),this.buttons[t].father=this,this.container.addChild(this.buttons[t])},i.prototype.setLanguage=function(){this.father.change(this.text)},i.prototype.change=function(t){var i=this.game.settings.Languages;this.buttons[i[this.game.activeLanguage]].tint="0xFFFFFF",this.game.activeLanguage=this.game.settings.Languages.indexOf(t),this.buttons[i[this.game.activeLanguage]].tint="0xFF0000",this.modify("Back",this.game.data.texts.Back),this.sortMenu()},i}(u),m=function(){this.container=new PIXI.Container,this.container.visible=!1,this.container.interactive=!0,this.container.buttonMode=!0};m.prototype.create=function(){var t=this.game.data.credits;void 0!==t.Background&&(this.background=new PIXI.Sprite(PIXI.Texture.from(t.Background))),this.buildText(),this.structuredText=new e(this.text,t.Style),this.container.addChild(this.structuredText),this.container.x=this.game.width/2,this.container.pivot.x=this.container.width/2,this.container.y=this.game.height,this.tween=PIXI.tweenManager.createTween(this.container),this.tween.from({y:this.game.height}).to({y:0-this.container.height}),this.tween.time=2e4,this.tween.expire=!0,this.tween.delay=500,this.tween.on("end",this.mainMenu.bind(this)),this.container.on("pointerup",this.mainMenu.bind(this))},m.prototype.show=function(){this.container.visible=!0,this.tween.start()},m.prototype.hide=function(){this.tween.stop().reset(),this.container.visible=!1},m.prototype.buildText=function(){var t,i=this.game.data.credits;for(this.text="",t=0;t<i.Lines.length;t++){this.text+="<title>",this.text+=i.Lines[t].Title[this.game.activeLanguage],this.text+="</title>",this.text+="\n";var e=void 0;for(e=0;e<i.Lines[t].Text.length;e++)this.text+=i.Lines[t].Text[e],this.text+="\n";this.text+="\n"}},m.prototype.update=function(){PIXI.tweenManager.update()},m.prototype.changeLanguage=function(){this.buildText(),this.structuredText.text=this.text},m.prototype.mainMenu=function(){this.game.scenes.Title.mainMenu()};var f=function(t){function i(){t.apply(this,arguments)}return t&&(i.__proto__=t),(i.prototype=Object.create(t&&t.prototype)).constructor=i,i.prototype.build=function(){this.states={},this.addState("MainMenu",new g),this.addState("Options",new l),this.addState("Credits",new m),this.addAction("MainMenu","Options",this.showOptions.bind(this)),this.addAction("MainMenu","Credits",this.showCredits.bind(this)),this.addAction("MainMenu","New",this.newAdventure.bind(this)),this.addAction("Options","Back",this.mainMenu.bind(this))},i.prototype.addAction=function(t,i,e){this.states[t].buttons[i].on("pointerup",e)},i.prototype.addState=function(t,i,e){this.states[t]=i,i.game=this.game,i.create(),this.container.addChild(this.states[t].container)},i.prototype.showOptions=function(){this.states.MainMenu.hide(),this.states.Options.show()},i.prototype.showCredits=function(){this.states.MainMenu.hide(),this.states.Credits.show(),this.game.activeState=this.states.Credits},i.prototype.mainMenu=function(){this.game.activeState=null,this.states.Credits.hide(),this.states.Options.hide(),this.changeLanguage(),this.states.MainMenu.show()},i.prototype.changeLanguage=function(){this.states.MainMenu.changeLanguage(),this.states.Credits.changeLanguage()},i.prototype.newAdventure=function(){this.game.start()},i}(c),y=function(t){function i(){t.apply(this,arguments)}return t&&(i.__proto__=t),(i.prototype=Object.create(t&&t.prototype)).constructor=i,i.prototype.build=function(){if(this.background.parentLayer=this.game.layer,this.background.interactive=!0,this.background.buttonMode=!0,this.background.on("pointertap",this.getPosition.bind(this)),this.walkable=new n(this.game.width,this.game.height),void 0!==this.config.WalkArea&&this.walkable.addPolygon(this.config.WalkArea),void 0!==this.config.Obstacles){var t=Object.values(this.config.Obstacles);this.config.Obstacles=t;for(var i=0;i<this.config.Obstacles.length;i++)this.walkable.addPolygon(this.config.Obstacles[i])}var e=this.config.Objects;if(e)for(var s=0;s<e.length;s++)void 0!==this.game.objects[e[s]]?this.container.addChild(this.game.objects[e[s]].sprite):console.log("Error:Game object "+e[s]+" not found");var o=this.config.Characters;if(o)for(var a=0;a<o.length;a++)void 0!==this.game.npcs[o[a]]?this.container.addChild(this.game.npcs[o[a]].sprite):console.log("Error:Game character "+o[a]+" not found")},i.prototype.getPosition=function(t){var i=t.data.getLocalPosition(this.game.app.stage);this.game.player.lock||null!==this.game.activeObject||this.game.player.move(i)},i.prototype.getPath=function(t,i,e,s){return this.walkable.findPath(t,i,e,s,0)},i}(c),v=function(){this.container=new PIXI.Container,this.sequenceIndex=0,this.played=!1};function b(t,i){var e=t.getBounds(),s=i.getBounds();return e.x+e.width>s.x&&e.x<s.x+s.width&&e.y+e.height>s.y&&e.y<s.y+s.height}function x(t,i){var e;return null!=t&&null!=i&&(e=t.hitArea?o.ContainsPoint(t.hitArea.points,i.x,i.y):i.hitArea?o.ContainsPoint(i.hitArea.points,t.x,t.y):b(t,i)),e}v.prototype.build=function(){if(this.config.Video)this.videoData=this.game.files.resources[this.config.Video].data,this.videoEnds=this.end.bind(this),this.videoData.addEventListener("ended",this.videoEnds);else if(this.config.Sequence){this.image=new PIXI.Sprite(PIXI.Texture.from(this.config.Sequence[this.sequenceIndex].Image));var t=Math.min(this.game.width/this.image.width,this.game.height/this.image.height);this.image.scale.set(t/2),this.container.interactive=!0,this.container.buttonMode=!0,this.container.on("pointertap",this.next.bind(this)),this.container.addChild(this.image),this.field=new PIXI.Text(this.config.Sequence[this.sequenceIndex].Text[this.game.activeLanguage],this.game.settings.Text.Style),this.field.anchor.set(.5,0),this.field.x=this.image.width/2,this.field.y=this.image.height+this.field.height/2,this.container.addChild(this.field),this.container.x=(this.game.width-this.image.width)/2,this.container.y=(this.game.height-this.image.height)/2}},v.prototype.show=function(){if(this.config.Video){var t=PIXI.Texture.from(this.videoData);this.videoSprite=new PIXI.Sprite(t),this.videoSprite.width=this.game.width,this.videoSprite.height=this.game.height,this.videoSprite.interactive=!0,this.videoSprite.buttonMode=!0,this.videoSprite.on("pointertap",this.end.bind(this)),this.container.addChild(this.videoSprite)}else this.config.Sequence&&(this.timeoutID=setTimeout(this.next.bind(this),1e3*this.config.Sequence[this.sequenceIndex].Time));this.game.app.stage.addChild(this.container),this.game.activeScene.hide(),this.game.inventory.hideIcon(),this.game.player.hide()},v.prototype.hide=function(){this.container.parent.removeChild(this.container)},v.prototype.next=function(){this.timeoutID&&clearTimeout(this.timeoutID),this.sequenceIndex<this.config.Sequence.length-1?(this.sequenceIndex+=1,this.field.text=this.config.Sequence[this.sequenceIndex].Text[this.game.activeLanguage],this.image.texture=PIXI.Texture.from(this.config.Sequence[this.sequenceIndex].Image),this.timeoutID=setTimeout(this.next.bind(this),1e3*this.config.Sequence[this.sequenceIndex].Time)):this.end()},v.prototype.end=function(){this.timeoutID&&clearTimeout(this.timeoutID),this.videoData&&(this.videoData.pause(),this.videoData.removeEventListener("ended",this.videoEnds)),this.hide(),this.played=!0,this.game.activeScene.show(),this.game.inventory.showIcon(),this.game.player.show()};var w=function(){this.sprite=null,this.game=null,this.action=null};w.prototype.build=function(){if(this.config.Texture)this.sprite=new PIXI.Sprite.from(PIXI.Texture.from(this.config.Texture));else if(this.config.Area)this.sprite=new PIXI.Sprite.from(PIXI.Texture.EMPTY),this.sprite.hitArea=new PIXI.Polygon(this.config.Area);else if(this.config.Animation){for(var t=this.game.files.resources[this.config.Animation.Name].spritesheet,i=[],e=0;e<t._frameKeys.length;e++)i.push(PIXI.Texture.from(t._frameKeys[e]));this.sprite=new PIXI.extras.AnimatedSprite(i),this.animationSpeed=this.config.Animation.Speed,this.play()}this.config.Position&&(this.sprite.x=this.config.Position[0],this.sprite.y=this.config.Position[1]),this.config.Size&&this.sprite.scale.set(this.config.Size),this.config.Area||this.sprite.anchor.set(.5,1),this.sprite.parentLayer="Front"==this.config.Layer?this.game.layeronTop:this.game.layer,this.config.Door&&(this.door=!0,this.newScene=this.config.Door.To,this.playerPos=this.config.Door.Player),this.sprite.interactive=!0,this.sprite.buttonMode=!0,void 0!==this.config.Area?this.sprite.on("pointerdown",this.touchArea.bind(this)).on("pointerup",this.releaseArea.bind(this)).on("pointerupoutside",this.releaseArea.bind(this)):this.sprite.on("pointerdown",this.touch.bind(this)).on("pointermove",this.move.bind(this)).on("pointerup",this.release.bind(this)).on("pointerupoutside",this.release.bind(this))},w.prototype.hide=function(){this.sprite.visible=!1},w.prototype.show=function(){this.sprite.visible=!0},w.prototype.touchArea=function(t){null===this.game.activeObject&&(this.game.activeObject=this,this.interaction=t.data,this.action=null,this.touchedPos=this.interaction.getLocalPosition(this.game.app.stage))},w.prototype.releaseArea=function(){if(this.interaction){var t=this.interaction.getLocalPosition(this.game.app.stage);x(t,this.sprite)?this.look():!0===this.door&&(i=this.config.Area,e=t,s=Math.round(e.x),n=Math.round(e.y),a=o.ClosestEdge(i,s,n).point,t={x:Math.round(a.x)+1,y:Math.round(a.y)+1},this.use()),null!==this.action?(this.game.player.tween.once("end",this.action),this.game.player.move(t)):this.cancel(),this.interaction=null,this.touchedPos=null}var i,e,s,n,a},w.prototype.touch=function(t){null===this.game.activeObject&&(this.game.activeObject=this,this.action=null,this.posX=this.sprite.x,this.posY=this.sprite.y,this.interaction=t.data,this.sprite.alpha=.5,this.dragging=!0,this.moved=0,this.oldParent=this.sprite.parent,this.sprite.parentLayer!==this.game.layerUI&&(this.sprite.parentLayer=this.game.layerUI))},w.prototype.move=function(){if(this.dragging){this.moved++,this.sprite.setParent(this.game.app.stage);var t=this.interaction.getLocalPosition(this.sprite.parent),i=this.sprite.getBounds();t.x>i.width/2&&t.x<this.game.width-i.width/2&&(this.sprite.x=t.x),t.y>i.height&&t.y<this.game.height&&(this.sprite.y=t.y)}},w.prototype.release=function(){if(this.interaction){var t={x:this.posX,y:this.posY};x(this.sprite,this.game.inventory.icon)&&this.config.Take?this.take():this.moved<3?this.look():!0===this.config.door?this.use():void 0!==this.config.Use&&(this.game.activePuzzle=this.game.puzzles[this.config.Use],this.use()),null!==this.action?(this.game.player.tween.once("end",this.action),this.game.player.move(t)):this.cancel(),this.sprite.x=this.posX,this.sprite.y=this.posY,this.sprite.alpha=1,this.sprite.parentLayer=this.game.layer,this.sprite.setParent(this.oldParent),this.interaction=null,this.dragging=!1,this.moved=0}},w.prototype.look=function(){this.action=this.game.player.look.bind(this.game.player)},w.prototype.take=function(){this.action=this.game.player.take.bind(this.game.player)},w.prototype.use=function(){this.action=this.game.player.use.bind(this.game.player)},w.prototype.hit=function(){var t,i=null,e=this.game.activeScene.config.Objects;for(t=0;t<e.length;t++)if(x(this.sprite,this.game.objects[e[t]].sprite)&&this.config.Name!==e[t]){i=e[t];break}for(e=this.game.inventory.objects,t=0;t<e.length;t++)if(x(this.sprite,this.game.objects[e[t]].sprite)&&this.config.Name!==e[t]){i=e[t];break}return i},w.prototype.cancel=function(){this.game.activeObject.action=null,this.game.activeObject=null},w.prototype.remove=function(){this.sprite.parent.removeChild(this.sprite)};var I=function(){this.container=new PIXI.Container,this.container.visible=!1,this.game=null,this.objects=[]};I.prototype.build=function(){this.background=new PIXI.Sprite(PIXI.Texture.from(this.game.settings.Inventory.Background)),this.background.width=this.game.width/2,this.background.height=this.game.height/2,this.background.parentLayer=this.game.layerUI,this.container.x=(this.game.width-this.background.width)/2,this.container.y=(this.game.height-this.background.height)/2,this.border=10,this.icon=new PIXI.Sprite(PIXI.Texture.from(this.game.settings.Inventory.Icon)),this.icon.on("pointertap",this.click.bind(this)),this.icon.interactive=!0,this.icon.buttonMode=!0,this.setIcon(this.game.settings.Inventory.Position),this.container.addChild(this.background),this.icon.parentLayer=this.game.layerUI},I.prototype.show=function(){this.update(),this.container.visible=!0},I.prototype.hide=function(){this.container.visible=!1},I.prototype.showIcon=function(){this.icon.visible=!0},I.prototype.hideIcon=function(){this.icon.visible=!1},I.prototype.setIcon=function(t){"bottom-right"==t?(this.icon.x=this.game.width-this.icon.width,this.icon.y=this.game.height-this.icon.height):"top-right"==t?(this.icon.x=this.game.width-this.icon.width,this.icon.y=0):"top-left"==t?(this.icon.x=0,this.icon.y=this.game.height-this.icon.height):"bottom-top"==t&&(this.icon.x=this.game.width-this.icon.width,this.icon.y=0)},I.prototype.click=function(){this.container.visible?this.hide():this.game.player.lock||this.show()},I.prototype.add=function(t){if(null!==this.game.activeScene&&this.game.activeScene.config.Objects.includes(t)){var i=this.game.activeScene.config.Objects.indexOf(t);this.game.activeScene.config.Objects.splice(i,1)}this.objects.push(t),this.game.objects[t].sprite.setParent(this.container),this.game.objects[t].sprite.parentLayer=this.game.layerUI,this.game.objects[t].sprite.on("pointermove",this.move.bind(this.game.objects[t])).off("pointerup").off("pointerupoutside").on("pointerup",this.release.bind(this.game.objects[t])).on("pointerupoutside",this.release.bind(this.game.objects[t])),this.update()},I.prototype.remove=function(t){this.objects.includes(t)&&(this.objects.splice(this.objects.indexOf(t),1),this.update())},I.prototype.update=function(){var t,i=this.objects.length;for(t=0;t<i;t++){var e=this.game.objects[this.objects[t]].sprite;e.width=this.container.width/5-.05*this.container.width,e.height=this.container.height/5-.05*this.container.height,e.x=t%5*this.container.width/5+this.border-t+e.width/2,e.y=Math.floor(t/5)*this.container.height/5+this.border-t+e.height,this.container.width=this.background.width,this.container.height=this.background.height}},I.prototype.move=function(){b(this.sprite,this.game.inventory.container)||this.game.inventory.hide()},I.prototype.release=function(t){if(this.interaction){var i=this.hit(),e={x:this.sprite.x,y:this.sprite.y};this.moved<3?this.game.player.say(this.config.Description):void 0!==this.config.Combine&&null!==i&&(this.config.Combine.With===i&&(this.game.activePuzzle=this.game.puzzles[this.config.Combine.Puzzle]),this.use()),null!==this.action?(this.game.player.tween.once("end",this.action),this.game.player.move(e)):this.cancel(),this.sprite.x=this.posX,this.sprite.y=this.posY,this.sprite.alpha=1,this.sprite.setParent(this.oldParent),this.interaction=null,this.dragging=!1,this.moved=0}};var P=function(){this.solved=!1};P.prototype.resolve=function(){if(this.config.Modify){var t=this.game.objects[this.config.Modify.Name];this.config.Modify.Description&&(t.config.Description=this.config.Modify.Description),this.config.Modify.Door&&this.createDoor(t)}if(this.config.Say&&!this.game.silentMode?this.game.player.say(this.config.Say[this.game.activeLanguage]):this.game.player.stop(),void 0!==this.config.Remove){var i,e=this.config.Remove;for(i=0;i<e.length;i++)this.game.objects[e[i]].remove()}this.solved=!0,this.game.activePuzzle=null,this.game.activeObject=null},P.prototype.createDoor=function(t){t.door=!0,t.newScene=this.config.Modify.Door.To,t.playerPos=this.config.Modify.Door.Player},P.prototype.createInventoryObject=function(t){};var S=h.dragonBones.PixiFactory.factory,T=function(){this.game=null,this.state=null,this.lock=!1};T.prototype.setup=function(t){S.parseDragonBonesData(this.game.files.resources[t.Name+"Skeleton"].data),S.parseTextureAtlasData(this.game.files.resources[t.Name+"Json"].data,this.game.files.resources[t.Name+"Tex"].texture),this.sprite=S.buildArmatureDisplay(t.Armature),this.size=1,this.tween=PIXI.tweenManager.createTween(this.sprite),this.tween.on("end",this.stop.bind(this)),this.animations=null!=t.Animations?t.Animations:{Stand:"stand",Walk:"walk",Take:"take",Use:"use",Say:"speak"},this.animate(this.animations.Stand),this.state="stand",this.sprite.x=500,this.sprite.y=500,this.sprite.parentLayer=this.game.layer,this.config=t},T.prototype.hide=function(){this.sprite.visible=!1},T.prototype.show=function(){this.sprite.visible=!0},T.prototype.position=function(t){this.sprite.x=t[0],this.sprite.y=t[1]},T.prototype.move=function(t){var i=t,e=function(t,i,e){var s,n,a=Math.round(t.x),h=Math.round(t.y);if(o.ContainsPoint(e,a,h)){if(void 0!==i)for(var r=0;r<i.length;r++)if(o.ContainsPoint(i[r],a,h)){s=o.ClosestEdge(e,a,h).point,n={x:Math.round(s.x)+1,y:Math.round(s.y)+1};break}}else s=o.ClosestEdge(e,a,h).point,n={x:Math.round(s.x)+1,y:Math.round(s.y)+1};return n}(t,this.game.activeScene.config.Obstacles,this.game.activeScene.config.WalkArea);e&&(i=e);var s=new PIXI.tween.TweenPath,n=this.game.activeScene.walkable.findPath(this.sprite.x,this.sprite.y,i.x,i.y,0);if(n.length>0){this.tween.stop().clear(),this.animate(this.animations.Walk),this.sprite.armature.flipX=!(this.sprite.x<i.x),s.drawShape(new PIXI.Polygon(n)),this.tween.path=s;var a=5*Math.abs(this.sprite.x-i.x)+5*Math.abs(this.sprite.y-i.y)+100*n.length;this.tween.time=a,this.tween.speed=1,this.tween.delay=10,this.tween.start()}},T.prototype.update=function(){PIXI.tweenManager.update(),this.scale()},T.prototype.scale=function(){this.sprite.scale.set(this.sprite.y/this.game.height*this.size)},T.prototype.stop=function(){this.animate(this.animations.Stand),this.game.activeState=null,this.lock=!1},T.prototype.say=function(t){this.lock=!0,this.game.textField.talker=this,this.game.textField.setText(t),this.game.textField.setColor(this.config.Color),this.game.textField.show(),this.animate(this.animations.Say),this.timeoutID&&clearTimeout(this.timeoutID),this.timeoutID=setTimeout(this.game.textField.end.bind(this.game.textField),this.game.textField.timeOut())},T.prototype.animate=function(t,i){this.sprite.animation.lastAnimationName!==t&&this.sprite.animation.fadeIn(t,.25,i)};var k=h.dragonBones.EventObject,j=function(t){function i(){t.apply(this,arguments)}return t&&(i.__proto__=t),(i.prototype=Object.create(t&&t.prototype)).constructor=i,i.prototype.move=function(i){t.prototype.move.call(this,i),this.game.activeState=this},i.prototype.look=function(){null!==this.game.activeObject&&(this.say(this.game.activeObject.config.Description[this.game.activeLanguage]),this.game.activeObject.cancel())},i.prototype.take=function(){this.lock=!0,this.animate(this.animations.Take,1),this.sprite.once(k.COMPLETE,this.takeEnd,this)},i.prototype.takeEnd=function(){null!==this.game.activeObject&&(this.game.inventory.add(this.game.activeObject.config.Name),this.game.activeObject.cancel(),this.stop())},i.prototype.use=function(){this.lock=!0,this.animate(this.animations.Use,1),this.sprite.once(k.COMPLETE,this.useEnd,this)},i.prototype.useEnd=function(){null!==this.game.activePuzzle?this.game.activePuzzle.resolve():null!==this.game.activeObject&&(this.game.activeObject.door?(this.game.setScene(this.game.activeObject.newScene,this.game.activeObject.playerPos),this.stop()):this.say(this.game.data.texts.NotUsable[this.game.activeLanguage]),this.game.activeObject.cancel())},i}(T),C=function(t){function i(){t.apply(this,arguments)}return t&&(i.__proto__=t),(i.prototype=Object.create(t&&t.prototype)).constructor=i,i.prototype.build=function(){this.sprite.interactive=!0,this.sprite.buttonMode=!0},i}(T),O=function(i){this.settings={},this.data={},this.width=i.width,this.height=i.height,this.playSounds=!0,this.app=new t.Application(i.width,i.height,{autoResize:!0,resolution:devicePixelRatio}),this.app.renderer.autoResize=!0,this.app.stage=new t.display.Stage,void 0!==i.autoResize?this.app.renderer.autoResize=i.autoResize:window.addEventListener("resize",this.resize.bind(this)),i.parent?document.getElementById(i.parent).appendChild(this.app.view):document.body.appendChild(this.app.view),this.preload(i.files)};return O.prototype.preload=function(i){this.loadinProgress=new t.Text("0 %",{fill:"white",fontSize:50}),this.loadinProgress.anchor.set(.5),this.loadinProgress.x=this.width/2,this.loadinProgress.y=this.height/2,this.app.stage.addChild(this.loadinProgress),this.jsons=new r,this.jsons.game=this,this.jsons.addJSON(i),this.jsons.load(this.load.bind(this))},O.prototype.load=function(){this.files=new r,this.files.game=this,this.files.addFiles(Object.values(this.jsons.resources)),this.files.load(this.setup.bind(this))},O.prototype.setup=function(){var t;this.app.stage.removeChild(this.loadinProgress),this.addZOrder(),this.resize(),this.scenes={},this.cutscenes={},this.objects={},this.npcs={},this.puzzles={},this.activeLanguage=0,this.activeScene=null,this.activeObject=null,this.activePuzzle=null,this.activeState=null,this.addScene("Title",new f,this.settings.TitleScreen);var i=this.data.objects.length;for(t=0;t<i;t++)this.addObject(this.data.objects[t].Name,new w,this.data.objects[t]);for(i=this.data.npc.length,t=0;t<i;t++)this.addNPC(this.data.npc[t].Name,new C,this.data.npc[t]);for(i=this.data.scenes.length,t=0;t<i;t++)this.addScene(this.data.scenes[t].Name,new y,this.data.scenes[t]);for(i=this.data.cutscenes.length,t=0;t<i;t++)this.addCutscene(this.data.cutscenes[t].Name,new v,this.data.cutscenes[t]);for(i=this.data.puzzles.length,t=0;t<i;t++)this.addPuzzle(this.data.puzzles[t].Name,new P,this.data.puzzles[t]);this.addInventory(),this.addTextField(),this.addPlayer(),this.setScene("Title"),this.app.ticker.add(this.loop.bind(this))},O.prototype.loop=function(t){null!=this.activeState&&this.activeState.update(t)},O.prototype.addObject=function(t,i,e){this.objects[t]=i,i.config=e,i.game=this,i.build()},O.prototype.addScene=function(t,i,e){this.scenes[t]=i,i.setup(e),i.game=this,i.build()},O.prototype.addCutscene=function(t,i,e){this.cutscenes[t]=i,i.config=e,i.game=this,i.build()},O.prototype.addPuzzle=function(t,i,e){this.puzzles[t]=i,i.config=e,i.game=this},O.prototype.setScene=function(t,i){null!==this.activeScene&&this.app.stage.removeChild(this.activeScene.container),this.activeScene=this.scenes[t],this.app.stage.addChild(this.activeScene.container),void 0!==i&&(this.player.sprite.x=i[0],this.player.sprite.y=i[1]),void 0!==this.activeScene.config.Player&&(void 0!==this.activeScene.config.Player.Position&&this.player.position(this.activeScene.config.Player.Position),void 0!==this.activeScene.config.Player.Size&&(this.player.size=this.activeScene.config.Player.Size,this.player.scale())),void 0!==this.activeScene.config.CutScene&&(this.cutscenes[this.activeScene.config.CutScene].played||this.cutscenes[this.activeScene.config.CutScene].show())},O.prototype.addZOrder=function(){this.sortGroup=new t.display.Group(0,!0),this.sortGroup.on("sort",function(t){t.zOrder=-t.y}),this.onTopGroup=new t.display.Group(1,!1),this.UIGroup=new t.display.Group(2,!1),this.layer=new t.display.Layer(this.sortGroup),this.layeronTop=new t.display.Layer(this.onTopGroup),this.layerUI=new t.display.Layer(this.UIGroup),this.app.stage.group.enableSort=!0,this.app.stage.addChild(this.layer),this.app.stage.addChild(this.layeronTop),this.app.stage.addChild(this.layerUI)},O.prototype.addInventory=function(){this.inventory=new I,this.inventory.game=this,this.inventory.build()},O.prototype.addPlayer=function(){this.player=new j,this.player.game=this,this.data.player.Name="player",this.player.setup(this.data.player)},O.prototype.addNPC=function(t,i,e){this.npcs[t]=i,i.game=this,i.setup(e),i.build()},O.prototype.addTextField=function(){this.textField=new p,this.textField.game=this,this.textField.build()},O.prototype.resize=function(){var t=window.innerWidth*window.devicePixelRatio,i=window.innerHeight*window.devicePixelRatio,e=Math.min(t/this.width,i/this.height);this.app.renderer.resize(this.width*e,this.height*e),this.app.stage.scale.set(e)},O.prototype.start=function(){this.setScene(this.settings.FirstScene),this.app.stage.addChild(this.inventory.container),this.app.stage.addChild(this.inventory.icon),this.app.stage.addChild(this.player.sprite),this.app.stage.addChild(this.textField.container)},console.log("JSGAM 5.0.0 https://github.com/kreezii/jsgam"),O});
//# sourceMappingURL=jsgam.umd.js.map
